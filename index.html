<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Performansi Teknisi - PRO MAX</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="brand">
      <div class="logo">TA</div>
      <div>
        <div class="brand-title">Performansi</div>
        <div class="brand-sub">Enterprise Monitoring<br/>Realtime Google Sheet</div>
      </div>
    </div>

    <div class="search">
      <input id="searchInput" placeholder="Search STO / teknisi / tiket..." />
    </div>

    <nav class="menu">
      <button class="menu-item active" data-tab="dashboard">Dashboard</button>
      <button class="menu-item" data-tab="tickets">Tickets</button>
      <button class="menu-item" data-tab="teams">Teams</button>
      <button class="menu-item" data-tab="teknisi">Teknisi Detail</button>
      <button class="menu-item" data-tab="reports">Reports</button>
      <button class="menu-item" data-tab="admin">Admin Panel</button>
    </nav>

    <div class="sidebar-info">
      <div class="info-row">
        <div class="info-label">Teknisi (unik)</div>
        <div class="info-value" id="sidebarTeknisiCount">0</div>
      </div>
      <div class="info-row" style="margin-top:6px;">
        <div class="info-label">Last Sync</div>
        <div class="info-value" id="sidebarLastSync">-</div>
      </div>
    </div>

    <div class="filters">
      <h4>FILTER</h4>

      <label>STO (Multi)</label>
      <div class="multi-dropdown" id="stoDropdown">
        <button class="multi-btn" id="stoDropdownBtn" type="button">
          <span id="stoDropdownText">Semua STO</span>
          <span class="chev">‚ñæ</span>
        </button>

        <div class="multi-menu" id="stoDropdownMenu">
          <div class="multi-top">
            <button class="mini" id="stoSelectAllBtn" type="button">Select All</button>
            <button class="mini" id="stoClearBtn" type="button">Clear</button>
          </div>
          <div class="multi-list" id="stoDropdownList"></div>
        </div>
      </div>

      <label>Teknisi</label>
      <select id="filterTeknisi">
        <option value="">Semua Teknisi</option>
      </select>

      <label>Status</label>
      <select id="filterStatus">
        <option value="">Semua Status</option>
        <option value="OPEN">OPEN</option>
        <option value="CLOSE">CLOSE</option>
      </select>

      <div class="filter-actions">
        <button class="btn secondary" id="exportBtn">Export CSV</button>
        <button class="btn primary" id="resetBtn">Reset</button>
      </div>
    </div>
  </aside>

  <!-- Main -->
  <main class="main">
    <header class="topbar">
      <div class="left">
        <button class="btn icon" id="toggleSidebarBtn">‚ò∞</button>
        <div>
          <h1>Dashboard</h1>
          <p>Monitoring OPEN/CLOSE ‚Ä¢ Ranking ‚Ä¢ UNSPEC Detail</p>
        </div>
      </div>

      <div class="top-actions">
        <button class="btn ghost" id="refreshBtn">‚Üª Refresh Data</button>
        <button class="btn ghost" id="darkModeBtn">üåô Dark</button>
        <span class="pill live">‚óè Live</span>
        <span class="pill" id="topLastSyncPill">Last Sync: -</span>

        <div class="profile">
          <div class="avatar">A</div>
          <div>
            <div class="name">Admin</div>
            <div class="role">Supervisor</div>
          </div>
        </div>
      </div>
    </header>

    <!-- DASHBOARD -->
    <section id="tab-dashboard" class="tab active">
      <div class="cards">
        <div class="card">
          <div class="card-title">Total Tiket</div>
          <div class="card-value" id="kpiTotal">0</div>
          <div class="card-sub">Akumulasi tiket (filter aktif)</div>
        </div>

        <div class="card">
          <div class="card-title">OPEN</div>
          <div class="card-value" id="kpiOpen">0</div>
          <div class="card-sub">Total tiket OPEN</div>
        </div>

        <div class="card">
          <div class="card-title">CLOSE</div>
          <div class="card-value" id="kpiClose">0</div>
          <div class="card-sub">Total tiket CLOSE</div>
        </div>

        <div class="card">
          <div class="card-title">Progress</div>
          <div class="card-value" id="kpiProgress">0%</div>
          <div class="card-sub">Close / Total</div>
        </div>

        <div class="card">
          <div class="card-title">Total Teknisi</div>
          <div class="card-value" id="kpiTeknisi">0</div>
          <div class="card-sub">Teknisi unik</div>
        </div>
      </div>

      <div class="grid2">
        <div class="panel">
          <div class="panel-title">Trend Progress (%)</div>
          <div class="panel-sub">Klik chart ‚Üí pindah Tickets</div>
          <canvas id="trendChart"></canvas>
        </div>

        <div class="panel">
          <div class="panel-title">Top 5 Teknisi (OPEN terbanyak)</div>
          <div class="panel-sub">Klik teknisi ‚Üí Teknisi Detail</div>
          <canvas id="topOpenChart"></canvas>
        </div>
      </div>

      <div class="panel">
        <div class="panel-title">Open vs Close per STO</div>
        <div class="panel-sub">Klik STO ‚Üí auto filter + Tickets</div>
        <canvas id="stoChart"></canvas>
      </div>
    </section>

    <!-- TICKETS -->
    <section id="tab-tickets" class="tab">
      <div class="panel">
        <div class="panel-title">Tickets</div>
        <div class="panel-sub">Klik tiket ‚Üí detail lengkap muncul</div>

        <div class="table-wrap">
          <table class="table" id="ticketsTable">
            <thead>
              <tr>
                <th>Tanggal</th>
                <th>STO</th>
                <th>Teknisi</th>
                <th>No Tiket</th>
                <th>Status</th>
                <th>Jenis</th>
                <th>Device</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="muted small-note" id="ticketsNote"></div>
      </div>
    </section>

    <!-- TEAMS / RANKING -->
    <section id="tab-teams" class="tab">
      <div class="panel">
        <div class="panel-title">Ranking Teknisi (Global)</div>
        <div class="panel-sub">Klik teknisi ‚Üí Teknisi Detail</div>

        <div class="table-wrap">
          <table class="table" id="rankingTable">
            <thead>
              <tr>
                <th>#</th>
                <th>Teknisi</th>
                <th>Total</th>
                <th>Open</th>
                <th>Close</th>
                <th>Progress</th>
                <th>UNSPEC</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="panel" style="margin-top:14px;">
        <div class="panel-title">Ranking per STO</div>
        <div class="panel-sub">Pilih STO dari dropdown ‚Üí tabel akan menyesuaikan</div>

        <div class="table-wrap">
          <table class="table" id="rankingStoTable">
            <thead>
              <tr>
                <th>STO</th>
                <th>#</th>
                <th>Teknisi</th>
                <th>Total</th>
                <th>Open</th>
                <th>Close</th>
                <th>Progress</th>
                <th>UNSPEC</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- TEKNISI DETAIL -->
    <section id="tab-teknisi" class="tab">
      <div class="panel">
        <div class="panel-title">Teknisi Detail</div>
        <div class="panel-sub">Klik teknisi dari chart/ranking ‚Üí otomatis tampil</div>

        <div class="tech-card">
          <div>
            <div class="tech-name" id="techName">-</div>
            <div class="tech-sub" id="techSub">Pilih teknisi untuk melihat detail</div>
          </div>

          <div class="tech-kpi">
            <div class="mini-kpi">
              <div class="mk-label">Total</div>
              <div class="mk-value" id="techTotal">0</div>
            </div>
            <div class="mini-kpi">
              <div class="mk-label">Open</div>
              <div class="mk-value" id="techOpen">0</div>
            </div>
            <div class="mini-kpi">
              <div class="mk-label">Close</div>
              <div class="mk-value" id="techClose">0</div>
            </div>
            <div class="mini-kpi">
              <div class="mk-label">Progress</div>
              <div class="mk-value" id="techProgress">0%</div>
            </div>
          </div>
        </div>

        <div class="panel" style="margin-top:14px;">
          <div class="panel-title">Semua tiket teknisi</div>
          <div class="panel-sub" id="techTicketNote">-</div>

          <div class="table-wrap">
            <table class="table" id="techTicketsTable">
              <thead>
                <tr>
                  <th>Tanggal</th>
                  <th>STO</th>
                  <th>No Tiket</th>
                  <th>Status</th>
                  <th>Jenis</th>
                  <th>Device</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

<!-- ADMIN PANEL -->
<section id="tab-admin" class="tab">
  <div class="panel">
    <div class="panel-title">Admin Panel (UNSPEC Override)</div>
    <div class="panel-sub">Edit teknisi/status/jenis tiket langsung ‚Üí update MASTER_UNSPEC</div>

    <div class="admin-grid">
      <div class="admin-card">
        <div class="admin-title">PIN Admin</div>
        <input type="password" id="adminPin" placeholder="Masukkan PIN..." />
        <div class="admin-hint">PIN ini sama dengan CONFIG.ADMIN_PIN di Apps Script</div>
      </div>

      <div class="admin-card">
        <div class="admin-title">No Tiket</div>
        <input type="text" id="adminNoTiket" placeholder="Contoh: INC123456..." />
        <div class="admin-hint">Wajib diisi</div>
      </div>

      <div class="admin-card">
        <div class="admin-title">Teknisi Override</div>
        <input type="text" id="adminTeknisi" placeholder="Nama teknisi (opsional)" />
      </div>

      <div class="admin-card">
        <div class="admin-title">Status Override</div>
        <select id="adminStatus">
          <option value="">(kosong)</option>
          <option value="OPEN">OPEN</option>
          <option value="CLOSE">CLOSE</option>
        </select>
      </div>

      <div class="admin-card">
        <div class="admin-title">Jenis Override</div>
        <input type="text" id="adminJenis" placeholder="Contoh: UNSPEC / SQM / REGULER" />
      </div>

      <div class="admin-card">
        <div class="admin-title">Catatan</div>
        <input type="text" id="adminCatatan" placeholder="Alasan override (opsional)" />
      </div>
    </div>

    <div class="admin-actions">
      <button class="btn primary" id="adminSaveBtn">‚úÖ Simpan Override</button>
      <button class="btn secondary" id="adminFillFromModalBtn">üìå Ambil dari tiket terakhir</button>
    </div>

    <div class="admin-result" id="adminResult">-</div>
  </div>
</section>

    <!-- REPORTS -->
    <section id="tab-reports" class="tab">
      <div class="panel">
        <div class="panel-title">Reports</div>
        <div class="panel-sub">Export & Monitoring</div>

        <div class="reports-grid">
          <div class="report-card">
            <div class="rc-title">Export Tickets</div>
            <div class="rc-sub">Export sesuai filter aktif</div>
            <button class="btn primary" id="exportTicketsBtn">Export Tickets</button>
          </div>

          <div class="report-card">
            <div class="rc-title">Export Ranking Global</div>
            <div class="rc-sub">Ranking global semua teknisi</div>
            <button class="btn secondary" id="exportRankingBtn">Export Ranking</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- MODAL DETAIL -->
  <div class="modal-backdrop" id="ticketModalBackdrop">
    <div class="modal">
      <div class="modal-head">
        <div>
          <div class="modal-title" id="modalTitle">Detail Tiket</div>
          <div class="modal-sub" id="modalSub">‚Äî</div>
        </div>
        <button class="btn icon" id="closeModalBtn">‚úï</button>
      </div>

      <div class="modal-body" id="modalBody"></div>

      <div class="modal-foot">
        <button class="btn secondary" id="copyTicketBtn">Copy No Tiket</button>
        <button class="btn primary" id="closeModalBtn2">Tutup</button>
      </div>
    </div>
  </div>

<script src="script.js"></script>
</body>
</html>
